FROM oven/bun:1 AS base

WORKDIR /usr/src/app

# 1️⃣ Copy dependency files first (cache-friendly)
COPY package.json bun.lock ./
RUN bun install

# 2️⃣ Copy the FULL source code (including src/)
COPY . .

# (Optional but VERY useful for debugging)
RUN ls -la
RUN ls -la src
RUN ls -la src/app || true
RUN ls -la src/pages || true

# 3️⃣ Build AFTER code exists
RUN bun run build

EXPOSE 3000

# 4️⃣ Run Next.js standalone output
CMD ["bun", "start"]
